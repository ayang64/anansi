2005-06-24  Ibrahim Tannir  <itannir@users.sf.net>

	* include/nscheck.h: VC for Windows cannot handle GNU preprocessor
	directives and macros (fixed).

	* nsd/driver.c: 
	* nsd/binder.c: Excluded Unix calls from Windows code since some
	of the structs needed to compile them are missing in Windows.

	* nsd/dns.c: Added missing header for Windows.
	* nsd/nsmain.c: Corrected normalizing the home path on Windows.
	* nsd/nswin32.c: Added provisions to fake that nsd as a service
	failed on Windows in order for the Service Control Manager to
	restart it automatically.
	* nsd/return.c: Added Ns_ConnReturnPath to open a file and send
	its contents via the connection.
	* nsd/tclcmds.c: Added the ns_failservice command which affects
	Windows only (see also changes in nswin32.c).

	* nsthread/compat.c:  Added NS_EXPORTS so that the Windows DLL
	can get loaded.

	* win32/cgitest/main.c: Removed superflous CRs at end of lines.

	* main.dsp:
	* nscgi.dsp:
	* nscp.dsp:
	* nsd.dsp:
	* nsdb.dsp:
	* nslog.dsp:
	* nsperm.dsp:
	* nssock.dsp:
	* nsthread.dsp: Changed projects to compile for and link with
	mutithreading & debug enabled libs (MTd instead of MDd).
	
	* main.vcproj:
	* nscgi.vcproj:
	* nscp.vcproj:
	* nsd.vcproj:
	* nsdb.vcproj:
	* nslog.vcproj:
	* nsperm.vcproj:
	* nssock.vcproj:
	* nsthread.vcproj: New files, VS7 projects for Windows.

2005-06-18  Vlad Seryakov  <seryakov@users.sf.net>

	* nsd/connio.c: Fixed bad return code for Ns_ConnReadLine as per 
        AOLServer bug report from the mailing list

	* sample-config.tcl: added maxline parameter for nssock section

	* nsd/driver.c:
	* nsd.nsd.h: added maxline parameter to driver section, checks 
	for line size limit in the request, defaults to 4k. 

2005-06-17  Stephen Deasey  <sdeasey@users.sf.net>

	* tests/harness.tcl:
	* tests/ns_urlencode.test: Use Tcl style tests and remove old harness.

2005-06-17  Vlad Seryakov  <seryakov@users.sf.net>

	* sample-config.tcl: added maxinput and bufsize parameters
	for nssock section

2005-06-16  Zoran Vasiljevic  <vasiljevic@users.sf.net>

	* nsd/driver.c
	* nsd/server.c
	* nsd/nsd.h: Removed maxpost config option (RFE #1222107)

2005-06-14  Vlad Seryakov  <seryakov@users.sf.net>

	nsd/binder.c: added missing listen call to Ns_SockListenUnix
	function.

2005-06-14  Zoran Vasiljevic  <vasiljevic@users.sf.net>

	* nsd/adpeval.c: Reformat to NaviServer coding style
	(no functional changes)

2005-06-13  Zoran Vasiljevic  <vasiljevic@users.sf.net>

	* nsd/compress.c: Fixed Ns_CompressGzip() declaration 
	when --without-zlib is used during compilation
	(first arg was lacking the "const" qualifier).

	* nsd/nswin32: Added (untested) implementation of
	NsMemMap() and NsMemUmap() calls.

2005-06-12  Stephen Deasey  <sdeasey@users.sf.net>

	* include/ns.h:
	* nsd/adpparse.c:
	* nsd/compress.c:
	* nsd/listen.c:
	* nsd/sock.c:
	* nsd/tclimg.c:
	* nsd/tclmisc.c:
	* nsd/tclresp.c:
	* nsd/uuencode.c:
	* nscp/nscp.c:
	* tests/tclresp.test: Fix some issues with mixing signed/unsigned
	data that gcc4 was complaining about and a couple of instances of
	uninitialised variables.

	* nsd/tclobjv.c: Simplify code and clarify comment.

	* nscgi/nscgi.c: Use non-depreciated functions.

	* nsd/str.c: Add new function Ns_StrIsHost.
	* include/ns.h:
	* nsd/nsd.h:
	* nsd/driver.c: Save the protocol seperate from the location in
	the driver structure and ensure the location always begins with a
	"protocol://" string.
	* nsd/server.c:
	* nsd/conn.c:
	* nsd/pathname.c: Simplify code by using protocol direct from
	driver structure and checking Host header with Ns_StrIsHost.

	* nsd/tclsock.c: Removed unused static function.

2005-06-12  Zoran Vasiljevic  <vasiljevic@users.sf.net>

	* nsd/conn.c:
	* nsd/info.c:
	* nsd/log.c:
	* nsd/queue.c:
	* nsd/tclfile.c:
	* nsd/tclhttp.c:
	* nsd/tclinit.c:
	* nsd/tcljob.c:
	* nsd/tclmisc.c:
	* nsd/tclthread.c
	* nsd/tclvar.c:
	* nsthread/nsthreadtest.c: silencecompiler warnings like
	"dereferencing type-punned pointer will break strict-aliasing rules"

2005-06-11  Vlad Seryakov  <seryakov@users.sf.net>

	nsd/return.c: made warning go away about parentheses around && and ||

2005-06-11  Stephen Deasey  <sdeasey@users.sf.net>

	* include/nscheck: Add new attribute NS_GNUC_SENTINEL which
	ensures that a NULL is passed as the last arg to a varargs
	function.  Also, make sure that the format arg in a printf-like
	function is non-NULL.
	* include/ns.h: Markup up with NS_GNUC_SENTINEL.
	* nsd/urlspace.c:
	* nsd/nslog.c: Say NULL rather than 0 when talking about null pointers.

2005-06-11  Zoran Vasiljevic  <vasiljevic@users.sf.net>

	* nsd/exec.c:     Fixed various places where log calls
	* nsd/nsmain.c:   were fed with wrong number or wrong 
	* nsd/driver.c:   types of arguments.

	* nsd/nsd.h:      Added wrappers for mem-mapping files in
	* nsd/fastpath.c: platform-neutral way. Only the unix part
	* nsd/unix.c:     is implemented. The Windows part is still
	* nsd/nswin32.c:  left to be done.

2005-06-10  Vlad Seryakov  <seryakov@users.sf.net>

        * nsd/driver.c:
        * nsd/binder.c: Determine path using Ns_PathIsAbsolute for Unix 
	domain sockets

	* nsd/tclresp.c: removed ns_returnbinary command. Added -binary
	flag to ns_return.

2005-06-10  Zoran Vasiljevic  <vasiljevic@users.sf.net>

	* include/ns.h Ns_SockBindUdp(), Ns_SockBindRaw() and Ns_SockBindUnix()
	are now exported.

	* nsd/init.c: NsInitBinder is also done for Windows as for Unix.

	* nsd/binder.c: Attempt to unify usage and call-conventions on various 
	Ns_SockListenXXX and Ns_SockBindXXX calls for various protocols 
	(tcp, udp, raw, unix).
	Also, parts not needed for windows build (pre-binding) are ifdef'ed out.
	Still open: handling of Unix-domain sockets on Windows. It might compile
	but will definitely not work because of the address parsing issues 
	(windows files do not begin with slash). This has to be sorted out.

2005-06-10  Vlad Seryakov  <seryakov@users.sf.net>

	* tests/tclresp.test: updated to reflect parameters change 
	for ns_respond, new -binary flag

	* nsd/binder.c: make Ns_SockListenUnix to use prebound
	sockets if available.

2005-06-10  Zoran Vasiljevic  <vasiljevic@users.sf.net>

	* nsd/nswin32.c: Cosmetic changes (reformatted, untabified).
	Added NsRestoreSignals as no-op to make symetrical to Unix counterpart
	and avoid excessive ifdefs for Windows.
	Replaced GNU poll implementation.

	* nsd/unix.c: Cosmetic changes (reformatted, untabified).
	
2005-06-10  Stephen Deasey  <sdeasey@users.sf.net>

	* configure.in:
	* include/config.h.in:
	* include/nsthread.h:
	* include/nsconfig.h.in: Rename config.h nsconfig.h to prevent
	clashes wth module/library config.h files.
	* configure: Rebuild configure.

	* include/ns.h:
	* include/nsthread.h:
	* nsd/conn.c:
	* nsd/nsd.h:
	* nsd/pathname.c:
	* nsd/rollfile.c:
	* nsd/server.c:
	* nsd/set.c:
	* nsd/tclinit.c:
	* nsd/tcljob.c:
	* nsd/tclsock.c:
	* nslog/nslog.c:
	* nsthread/mutex.c: Use CONST declarations to silence compiler.

	* include/ns.h:
	* include/nsthread.h: Add a variety of NS_GNUC_* annotations.

	* *.c: Use NS_RCSD() macro to quieten compiler.

	* NEWS: Add latest news and remove news which belongs to other modules.

	* include/Makefile.global.in: Enable Tcl CONST checking.
	* include/nsthread.h:
	* include/nscheck.h: Add support for extra GCC checks. (RFE #1215725)

2005-06-09  Stephen Deasey  <sdeasey@users.sf.net>

	* include/Makefile.global.in: Remove TCL_DEFS which isn't needed
	now that autoheader is used.
	* configure.in: Add call to TEA_TIME_HANDLER for time defs.
	* configure:
	* include/config.h.in: Rebuild configure and config.h.

2005-06-09  Vlad Seryakov  <seryakov@users.sf.net>

	* include/Makefile.global.in: added missing TCL_DEFS
	in CFLAGS

2005-06-08  Vlad Seryakov  <seryakov@users.sf.net>

        * sample-config.tcl: added example of dynamic virtual hosting
       
        * include/ns.h:
	* nsd/tclobjv.c: added Ns_ObjvByteArray function to
        accept binary arrays as input parameters.

	* nsd/tclcmds.c:
	* nsd/tclresp.c: added ns_returnbinary command to be able
	to return possibly binary data to the connection. Currently 
	ns_return family support this from files or open fds only.
        Added -binary flag to ns_respond to return binary data without
        encoding conversion.

2005-06-08  Stephen Deasey  <sdeasey@users.sf.net>

	* Makefile: Make sure derived files don't end up in the tarball.

	* Makefile:
	* NEWS: Add latest news.

2005-06-04  Stephen Deasey  <sdeasey@users.sf.net>

	* configure:
	* configure.in:
	* include/Makefile.global.in:
	* Makefile: Add 'dist' Makefile target.  Rebuild configure.

	* configure:
	* configure.in:
	* include/config.h.in:
	* include/ns.h: Move definition of version information from main
	header into configure script.  Rebuild configure.

	* Makefile: Also remove include/config.h on distclean.

	* configure:
	* configure.in:
	* include/nsthread.h:
	* include/Makefile.global.in:
	* include/config.h.in: Update configure.in to use an autoheader
	generated config.h.in.  Rebuild configure.

	* configure:
	* tcl.m4: Update to revision 1.64 of tcl.m4 from Tcl cvs which
	adds AC_DEFINE descriptions for use with autoheader.  Rebuild
	configure.

2005-05-21  Zoran Vasiljevic  <vasiljevic@users.sf.net>

	* nsd/driver.c: fixed coredump in NsStartDrivers() if the driver
	does not have the bindaddr defined (i.e. it is NULL).

2005-05-20  Vlad Seryakov  <seryakov@users.sf.net>

	* ns/include.h:
	* nsd/driver.c: added support for UDP and Unix domain sockets
	for HTTP over udp/unix sockets. Removed obsolete driver functions.

2005-05-16  Stephen Deasey  <sdeasey@users.sf.net>

	* aclocal.m4:
	* tcl.m4
	* configure.in:
	* configure:
	* include/Makefile.global.in:
	* include/Makefile.module.in: Include tc.m4 macros and convert to
	Tcl TEA build system.  Add messages to all autoconf feature
	tests.  Remove unneeded feature tests.  Rebuild configure script using
	autoconf 2.59.

2005-05-15  Stephen Deasey  <sdeasey@users.sf.net>

	* include/ns.h:
	* nsd/nsd.h:
	* nsd/info.c:
	* nsd/nsmain.c:
	* nscp/nscp.c: Remove redundant Ns_InfoLabel(). Use Ns_InfoTag() instead.

	* include/ns.h: Bump version to 4.99.0 alpha.

	* include/ns.h:
	* nscp/nscp.c:
	* nsd/adpeval.c:
	* nsd/conn.c:
	* nsd/driver.c:
	* nsd/info.c:
	* nsd/init.tcl:
	* nsd/sock.c:
	* nsd/tclinit.c:
	* nsd/tcljob.c:
	* nsd/tclmisc.c:
	* nsd/tclset.c:
	* nsd/urlopen.c:
	* nsthread/nsthreadtest.c: Silence some compiler warnings.

	* nsd/tcljob.c:
	* nsd/tclobjv.c:
	* nsd/tclxkeylist.c:
	* nsd/unix.c: Hide global symbols which shouldn't be exported.

	* Makefile: Add new "checkexports" target which prints out a list
	of global symbols which shouldn't be.

2005-05-14  Stephen Deasey  <sdeasey@users.sf.net>

	* tcl/nsdb.tcl:
	* nsdb/util.tcl:
	* nsdb/Makefile: Move nsdb module's Tcl file into module directory
	and add to module shared Tcl install target.

	* nsperm/Makefile: Use new TCL variable to install shared Tcl
	files.

	* include/Makefile.module.in: Add new MODNAME and TCL Makefile
	variables which modules can use to specify a list of shared tcl
	files to install.

2005-05-13  Stephen Deasey  <sdeasey@users.sf.net>

	* nsd/init.tcl (_ns_sourcemodule): Module's shared tcl directory
	was incorrectly set to private directory.

2005-05-11  Zoran Vasiljevic  <vasiljevic@users.sf.net>

	* nsd/urlencode.c: added URLDECODE_RELAXED (undefined per default)
	to be able to adjust url decoding to replace '+' to ' ', thus being
	more forgiving to urls encoded with (broken) AOLserver urlencoder.

2005-05-04  Zoran Vasiljevic  <vasiljevic@users.sf.net>

	* nsd/unix.c: modified poll() wrapper to work on Darwin 6.x 
	in addition to 7.x and 8.x versions. Also, heavily reformatted
	poll() wrapper to be easily readable.

	* nsd/tclmisc.c: conditionally define u_int32_t and u_int8_t
	on Darwin since it has the definition already. 

2005-04-30  Stephen Deasey  <sdeasey@users.sf.net>

	* nsd/nsmain.c: Don't assign chroot directory as default server
	name.  Simplify option parsing error messages.

2005-04-27  Vlad Seryakov  <seryakov@users.sf.net>

	nsd/tclmisc.c: updated ns_uudecode to return possibly binary decoded data
	in the Tcl_Obj result instead of string result

2005-04-26  Stephen Deasey  <sdeasey@users.sf.net>

	* include/nsdb.h:
	* nsdb/nsdb.h:
	* nsdb/Makefile: Move nsdb public header file into module directory.

	* include/nsextmsg.h:
	* include/nspd.h: Move stray headers into external modules.

	* include/Makefile.module.in:
	* include/Makefile.global.in:
	* Makefile: Add new module variable LIBHDRS which is the list of
	headers which should be installed for other modules to link
	against (e.g. nsdb.h).

	* include/Makefile.module.in:
	* include/Makefile.global.in: Reindent code for consistency prior
	to making changes.

	* tests/testserver/pages/ns_adp_compress.adp: Add missing file for
	gzip compression tests.

	* tests/testserver/modules/vhost.tcl: Add supporting procs for
	virtual hosting tests.

	* nsd/tclresp.c: Cleanup and reformat code.  Clarify comments.

	* tests/ns_conn_host.test:
	* tests/ns_pagepath.test:
	* ns_serverpath.test: Convert to new nstest_http command and the
	use seperate virtual hosts for tests.

	* tests/http.test:
	* ns_adp_compress.test:
	* tclresp.test: Convert	to new nstest_http command for testing
	http responses.

	* tests/test.nscfg: Create seperate virtual servers for virtual
	host tests and custom serverroot and conn host tests.

	* tests/testserver/pages/10bytes: Add missing 10bytes file for
	tclresp.test.

	* tests/testserver/modules/http.tcl:
	* tests/testserver/modules/testhttp.tcl: Rename http.tcl
	testhttp.tcl so that it doesn't overide the standard tcl/http.tcl
	file.  Command now correctly only sets default headers once so
	that e.g. the Host header can be overridden. Retrieve host and
	port to connect to from config file.


2005-04-26  Vlad Seryakov  <seryakov@users.sf.net>

	* tcl/file.tcl: added support for caching tcl bytecode if 
	ns_cache module is loaded, it is used to be in tclcache.tcl 
	file which is missing in NS

2005-04-21  Zoran Vasiljevic  <vasiljevic@users.sf.net>

	* nsd/httptime.c: fixed usage of non-mt-safe timegm()
	by adding a protective lock (Bug#  1187635).

2005-04-17  Zoran Vasiljevic  <vasiljevic@users.sf.net>

	* nsd/conn.c: removed "ns_conn flush" option added 
	recently since not needed. The trick is done with 
	the "ns_headers" command.

2005-04-18  Stephen Deasey  <sdeasey@users.sf.net>

	* nsd/nsd.h:
	* nsd/tclcmds.c:
	* nsd/tclresp.c:
	* tests/tclresp.test: Remove support for connid parameter to tcl
	response commands. (RFE #1156107)

	* nsd/conn.c:
	* tests/ns_conn_host.test: Prevent truncation of content already in
	dstring when location is appended.  Use nstest_http in tests.

	* nsd/nsconf.c:
	* tests/test.nscfg:
	* tests/testserver/modules/http.tcl: Add helper command
	nstest_http for test suite and new config parameter
	ns/parameters/tcllibrary so that the tcl shared library can be set
	to an arbitrary path.

2005-04-17  Zoran Vasiljevic  <vasiljevic@users.sf.net>

	* tests/ns_nsv.test: added new file.
	Credits to Bernd (b.eidenschink@kinetiqa.de).

2005-04-17  Zoran Vasiljevic  <vasiljevic@users.sf.net>

	* nsd/conn.c: ns_conn status was wrongly returning the
	changed status code instead of the previous value.
	This was introduced (again) by the changes below.

2005-04-16  Zoran Vasiljevic  <vasiljevic@users.sf.net>

	* nsd/nsmain.c: removed extra colon in variable declaration
	which caused some older gcc compilers to break.

	* nsd/conn.c: added "ns_conn flush" as per RFE #1184271
	and untabified and reidented the file (eh, old nit-picker)

2005-04-11  Stephen Deasey  <sdeasey@users.sf.net>

	* include/ns.h:
	* nsd/nsd.h:
	* nsd/info.c:
	* nsd/proc.c:
	* nsd/return.c:
	* nsd/server.c:
	* nsd/fastpath.c:
	* nsd/pathname.c: New concept: server root. Callback can be
	registered to create the server root, defaults to statically
	assigned 'serverroot' from config, or host-based if enabled.
	Many virtual hosting options added. (RFE #1159471)
	* nsd/conn.c: Add callback to generate current location. If none
	registered, uses host-header and falls back to driver's location.
	Add new Ns_ConnAppendLocation() as preferred method of access,
	depreciated Ns_ConnLocation().
	* nsd/tclcmds.c: Add vhost related Tcl commands: ns_serverpath
	ns_pagepath ns_hashpath ns_serverrootproc ns_locationproc.
	* ns_pagepath.test:
	* ns_conn_host.test:
	* ns_serverpath.test:
	* ns_hashpath.test:
	* tests/test.nscfg: Add tests for vhost related commands. More
	location tests needed...

	* nsd/proc.c: Add proc info for NsFastGet.  Cleanup source code
	formatting.

	* tests/ns_urlencode.test: Add missing tests for urlencode fix.

2005-04-09  Stephen Deasey  <sdeasey@users.sf.net>

	* tests/ns_parseargs.test: Re-enable test for corrupted literal
	table.

2005-04-09  Zoran Vasiljevic  <vasiljevic@users.sf.net>

	* nsd/dns.c: Fixed GetAddr() when dealing with gethostbyname_r
	  calls. In some/many cases we ended up in an infinite loop.

	* nsd/tclobjv.c: SetSpecFromAny does not invalidate string rep 
	  of the passed object after converting it to the ns:spec
	  object type. This will definitely corrupt the interp literal
	  table and result in process exitus when the interp is being
	  destroyed.
	* nsd/tclobj.c: fixed broken ptr deref
	* nsd/nsmain.c: adjusted options parsing for Windows / unix

2005-04-08  Zoran Vasiljevic  <vasiljevic@users.sf.net>

	* nsd/nsd.h: Added non-gnu implementation of poll() for
	* nsd/unix.c: platforms not implementing it (Darwin)

2005-04-03  Vlad Seryakov  <seryakov@users.sf.net>

	* nsd.nsmain.c: fixed make test, argumens nowe processed
	  until first non dash parameter.

2005-04-03  Vlad Seryakov  <seryakov@users.sf.net>

	* nsd/nsmain.c: changed command line parsing from getopt to
	  simple manual processing thus getopt is not needed anymore.
	* nsd/getopt.c: removed because no needed anymore

2005-04-02  Stephen Deasey  <sdeasey@users.sf.net>

	* nsd/nsd.h:
	* nsd/driver.c:
	* nsd/tclinit.c:
	* nsd/nsmain.c: Add -c command line option which causes the server
	to start in command mode, reading commands from stdin and
	executing them like a tclsh.

	* Makefile:
	* tests/test.nscfg:
	* tests/all.tcl: Add new Makefile targets test, runtest and gdb
	which start the server in command mode.  Modify the test runner
	and add a test server config file.

	* tests/http.test:
	* tests/ns_addrbyhost.test:
	* tests/ns_adp_compress.test:
	* tests/ns_hostbyaddr.test:
	* tests/ns_hrefs.test:
	* tests/ns_parseargs.test: Update tests to use tlctest syntax and
	features.

2005-04-02  Vlad Seryakov  <seryakov@users.sf.net>

	* nsd/tclcmds.c: added synonyms for ns_uuencode/ns_uudecode procs
	  as ns_base64encode/ns_base64decode, because those functions actually
	  do base64 encoding
	* nsd/tclmisc.c:
	* nsd/uuencode.c: modified uuencode/decode to support
	  string buffers any size and be compatible with GNU uuencode,
	  i.e. wrapping lines to be 60 chars. (RFE #1175025)

2005-03-28  Vlad Seryakov  <seryakov@users.sf.net>

	* nsd/nsd.h:
	* nsd/info.c:
	* nsd/op.c:
	* nsd/urlspace.c: Added support for ns_info filters, 
	  ns_info traces, ns_info requestprocs commands using new 
 	  Tcl callback interface. New commands show information about
	  registered filters/procs same way as ns_info scheduled does.
	  (RFE #1161597)

2005-03-27  Vlad Seryakov  <seryakov@users.sf.net>

	* nsd/tlrequest.c: In Ns_RegisterFilterObj command 'when'
	  was not initialized with 0 and because this is Ored flags
	  registered filters had incorrect mask.

2005-03-26  Stephen Deasey  <sdeasey@users.sf.net>

	* include/ns.h:
	* nsd/nsd.h:
	* nsd/proc.c:
	* nsd/tclrequest.c: Convert to new callback and parse proc APIs.
	Remove support for old connId parameter.

	* tcl/file.tcl:
	* tcl/util.tcl: Remove support for old connId parameter.
	
	* include/ns.h:
	* nsd/nsd.h:
	* nsd/Makefile:
	* nsd/tclcallbacks.c: Add routines to support calling Tcl code
	from C for callback events. (RFE #1162223)

	* nsd/proc.c:
	* nsd/tclcmds.c:
	* nsd/tclsched.c: Update to use new callback and parse proc APIs.
	
	* include/ns.h:
	* nsd/Makefile:
	* nsd/tclcmds.c:
	* nsd/cookies.c: Add cookie API for C and Tcl.  (RFE #1145957)

	* include/ns.h:
	* nsd/nsd.h:
	* nsd/tclobjv.c:
	* nsd/tclcmds.c:
	* tests/ns_parseargs.test: Change the signature of Ns_ObjvProc()s
	to return either TCL_OK, TCL_ERROR or TCL_BREAK.  Fixes a bug
	where options were being double-counted as args.  Also simplified
	the Ns_ObjvProc interface by passing the Ns_ObjvSpec directly.

	Added a new Tcl command: ns_parseargs specification args.  It
	parses options, args and handles defaults.

	* nsd/tclobj.c: Added some wrapper procs for handling Tcl obj
	types.

	* nsd/tclinit.c: Added Ns_TclPrintfResult() as a convenience for
	writing ints into a formatted string result.

2005-03-23  Vlad Seryakov <vlad@crystalballinc.com>

         include/ns.h:  Make Ns_SockBindUdp public function, it is public in
         nsd/binder.c already.

2005-03-22  Vlad Seryakov <vlad@crystalballinc.com>

         nsd/driver.c:  Ensure that socket driver's DriverClose callback 
         gets executed when the socket is released.  This was causing a 
         memory leak for HTTPS connections with nsopenssl when a Keep-Alive 
         HTTP request timed out. Closes SF Bug #1160850 from AOLServer.

2005-03-18  Zoran Vasiljevic  <vasiljevic@users.sf.net>

	* nsd/conn.c: Modified NsTclWriteContentObjCmd() to
	  consult reqPtr->avail instead of conn->contentLength
	  when examining how much bytes from the content is
	  still left to copy. The conn->contentLength is not
	  touched any more.

	* tcl/fastpath.tcl:
	* nsd/nsd.h:
	* nsd/return.c:
	* nsd/server.c: Removed handling of aolpress (RFE #1165562)

2005-03-17  Zoran Vasiljevic  <vasiljevic@users.sf.net>

	* nsd/conn.c: Added [ns_conn channel] (RFE #1156141)
	  Also, added [ns_conncptofp ?-bytes toCopy? channel]
	  (RFE #1156899). This change scraps parsing of the 
	  dummy connId argument left for 2.x server compat.

	* nsd/nsd.h
	* nsd/unix.h
	* nsd/nsmain.h: Added watchdog implementation (RFE #1156875)

2005-03-12  Vlad Seryakov <vlad@crystalballinc.com>

        * nspd/
        * nsext/: moved modules out of the core into modules /section

2005-03-08  Vlad Seryakov <vlad@crystalballinc.com>

	* nslog/nslog.c: as Stephan pointed there is possibility for 
	server to crash under some conditions accessing already freed 
	extheaders pointer. So i put lock before putting extheaders values 
        in the log, in most cases extheaders are empty so there is no overhead.

2005-03-07  Zoran Vasiljevic  <vasiljevic@users.sf.net>

	* nslog/nslog.c: fixed bad handling of rollfmt arg which
	caused segmetantion if the alternative rollfmt was not
	defined.

2005-03-07  Vlad Seryakov <vlad@crystalballinc.com>

        * include/hs.h:
        * nsd/conn.c: changed return status for Ns_ConnSetResponseStatus
        to void, corrected comments for this function.

2005-03-06  Vlad Seryakov <vlad@crystalballinc.com>

	* nsd/tclmisc.c:
	* nsd/tclcmds.c: added ns_sha1 command.

2005-03-06  Zoran Vasiljevic  <vasiljevic@users.sf.net>

	* nsd/tclxkeylist.c:
	* nsd/tclcmds.c: added objectified version of TclX keyed lists.

2005-03-05  Vlad Seryakov <vlad@crystalballinc.com>

	* nsd/conn.c include/ns.h Add Ns_ConnSetResponseStatus command to
        be able to se response status without touching headers. Also
        ns_conn status has been extended with ability to set response 
        status if third argument is provided. ns_conn status ?newStatus?

        * nslog/nslog.c: changed syntax to conform naviserver style,
        no functional modifications

2005-03-04  Stephen Deasey  <sdeasey@users.sf.net>

	* nsd/tclobjv.c: Add support for boolean options which take no
	argument. Truth is determined by presence of the option alone.

2005-03-01  Vlad Seryakov <vlad@crystalballinc.com>

	* nslog/nslog.c: redone options support for the module
        using flags, added commands to ns_accesslog to change flags and/or
        extended headers on the fly 

2005-02-27  Stephen Deasey  <sdeasey@users.sf.net>

	* nsd/tclobjv.c: Short circuit option processing when "--" is found.
	Accurately describe optional arguments as optional in error messages.

	* include/ns.h:
	* nsd/form.c:
	* nsd/request.c:
	* nsd/urlencode: Decode + and other characters in URL paths
	correctly.  Fixes bug #1145277.

	* nsd/mimetypes.c: XML mime types changed to application/xml from
	text/xml, fixes bug #1145927.  Added a handful of new mime
	mappings.

2005-02-26  Zoran Vasiljevic  <vasiljevic@users.sf.net>

	* nsd/tclobjv.c: New file with objv argument parsing code

	* nsd/Makefile: Added compliation directive for nsd/tclobjv.c

	* include/ns.h: Added declarations... 
 	 for following structs:
	    o. Ns_ObjvSpec
	    o. Ns_ObjvTable
	  and following calls:
	    o. Ns_ParseObjv
	    o. Ns_ObjvBool
	    o. Ns_ObjvInt
	    o. Ns_ObjvLong
	    o. Ns_ObjvWideInt
	    o. Ns_ObjvDouble
	    o. Ns_ObjvString
	    o. Ns_ObjvObj
	    o. Ns_ObjvIndex
	    o. Ns_ObjvFlags
	    o. Ns_ObjvBreak
	    o. Ns_ObjvArgs
	  This all implements new argument parsing code from Stephen.
 
2005-02-26  Zoran Vasiljevic  <vasiljevic@users.sf.net>

	* nsd/unix.c:
	* include/ns.h: added Ns_GetNameForUid(), Ns_GetNameForGid()
	
	* nsd/nsmain.c: allows server to be started as uid == 0
	  if both of the following are true:
	     o. the caller process is running as root (getuid() == 0)
	     o. "-u root" or "-u 0" was given on the command line
	  Also, improved and tightented verification of passed user
	  and/or group information.

2005-02-24  Vlad Seryakov <vlad@crystalballinc.com>

	* include/ns.h nsd/nsd.h nsd/binder.c: changed server name 
	  from AOLserver to NaviServer in ns_info command.
	  New ListenXXX family functions declared in the ns.h file. 

2005-02-22  Vlad Seryakov <vlad@crystalballinc.com>

	* nsd/tclsched.c nsd/tclcmds.c doc/at.n: added ns_atstartup
	  Tcl command to be run after server started and initialized. 
	  Update documentation about those commands, kind of.

2005-02-17  Zoran Vasiljevic <vasiljevic@users.sf.net>

	* nsd/tclfile.c: fixed broken NsTclChanObjCmd command which
	  caused server crashes when trasporting channels between 
	  threads when linked against Tcl 8.4+ library (Bug #1143586)

2005-02-16 Vlad Seryakov <vlad@crystalballinc.com>

	* Makefile configure configure.in sample-config.tcl 
	  include/Makefile.build include/Makefile.global.in 
	  include/Makefile.module.in include/ns.h include/nsdb.h 
	  include/nsextmsg.h include/nspd.h include/nsthread.h
	  tcl/charsets.tcl tcl/compat.tcl tcl/debug.tcl tcl/fastpath.tcl
	  tcl/file.tcl tcl/form.tcl tcl/http.tcl tcl/init.tcl
	  tcl/nsdb.tcl tcl/util.tcl: modified license in the header

	* tcl/sendmail.tcl: added erro notification flag to smtp_recv proc,
	  when receiving last QUIT response, do not fire exception if
	  remote server just drops the connection on QUIT

	* nsd/binder.c: added UDP/UNIX/RAW protocols to the sockets,

	* nsd/init.c: call InitLog before dns resolver will try to resolve 
	  local host, this prevents server crash

	* nsd/tclsock.c: back ported from CVS 4.1, added -localhost/-localport
	  to ns_scokopen

	* nsdb/dbdrv.c: if driver set exception in select, do to rewrite it 
	  in the server

2005-02-15  Zoran Vasiljevic <vasiljevic@users.sf.net>

	--- INITIAL IMPORT OF 4.0.10 AOLSERVER CODE ---
