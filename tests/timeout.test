#
# $Header$
#


package require tcltest 2.2
namespace import -force ::tcltest::*

eval ::tcltest::configure $argv



test timeout-1.1 {Tcl page} -constraints knownBug -body {
    nstest_http -getbody 1 GET /timeout.tcl
} -match glob -result {503 *Service Unavailable*}

test timeout-1.2 {Tcl filter} -setup {
    ns_register_filter preauth GET /timeout-1.2 \
        {error "timeout waiting for x" "" NS_TIMEOUT ;# }
} -body {
    nstest_http -getbody 1 GET /timeout-1.2
} -match glob -result {503 *Service Unavailable*}

test timeout-1.3 {registered proc} -setup {
    ns_register_proc GET /timeout-1.3 \
        error "timeout waiting for x" "" NS_TIMEOUT
} -body {
    nstest_http -getbody 1 GET /timeout-1.3
} -cleanup {
    ns_unregister_proc GET /timeout-1.3
} -match glob -result {503 *Service Unavailable*}

# NB: ADP pages run all script chunks, catching and logging any errors.



cleanupTests
